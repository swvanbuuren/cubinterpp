#include <gtest/gtest.h>
#include <cubinterpp.hpp>
#include "assertion_helpers.hpp"


using Vector = std::vector<double>;
using NaturalSpline = cip::NaturalSpline2D<double, cip::BoundaryConditionType::NotAKnot>;
constexpr double TOLERANCE = 5.0e-7;

// Note: this test uses the 2D assertions with significant higher tolerance (presumably due
// the use of different solvers that generated the comparion data)
TEST(TestCubicSpline2D, test_natural_spline_2d) {
    cip::Vector x = { 1.0, 2.0, 3.0, 4.0, 5.0, 5.5, 7.0, 8.0, 9.0, 9.5, 10.0 };
    cip::Vector y = { 1.0, 2.0, 3.0, 4.0, 5.0, 5.5, 7.0, 8.0, 9.0, 9.5, 10.0 };
    cip::Vector2 f = { 
                       { 0.0, 0.0, 0.0, 3.0, 2.4000000000000004, 7.199999999999999, 7.199999999999999, 0.6000000000000001, 0.0, 1.7999999999999998, 3.5999999999999996 }, 
                       { 0.0, 0.0, 0.0, 3.0, 2.4000000000000004, 7.199999999999999, 7.199999999999999, 0.6000000000000001, 0.0, 1.7999999999999998, 1.7999999999999998 }, 
                       { 0.0, 0.0, 0.0, 3.0, 2.4000000000000004, 7.199999999999999, 7.199999999999999, 0.6000000000000001, 0.0, 0.0, 0.0 }, 
                       { 0.0, 0.0, 0.0, 3.0, 2.4000000000000004, 7.199999999999999, 7.199999999999999, 0.6000000000000001, 0.6000000000000001, 0.6000000000000001, 0.6000000000000001 }, 
                       { 0.0, 0.0, 0.0, 3.0, 2.4000000000000004, 7.199999999999999, 7.199999999999999, 7.199999999999999, 7.199999999999999, 7.199999999999999, 7.199999999999999 }, 
                       { 0.0, 0.0, 0.0, 3.0, 2.4000000000000004, 7.199999999999999, 7.199999999999999, 7.199999999999999, 7.199999999999999, 7.199999999999999, 7.199999999999999 }, 
                       { 0.0, 0.0, 0.0, 3.0, 2.4000000000000004, 2.4000000000000004, 2.4000000000000004, 2.4000000000000004, 2.4000000000000004, 2.4000000000000004, 2.4000000000000004 }, 
                       { 0.0, 0.0, 0.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0 }, 
                       { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 }, 
                       { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 }, 
                       { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 }
                     };
    cip::Vector x_fine = { 1.0, 3.25, 5.5, 7.75, 10.0 };
    cip::Vector y_fine = { 1.0, 3.25, 5.5, 7.75, 10.0 };
    cip::Vector2 f_fine = { 
                            { 0.0, 0.8693532649540535, 7.199999999999999, 1.9560590176954866, 3.5999999999999996 }, 
                            { 0.0, 0.8691811307592404, 7.210400155433334, 1.5318404459184771, -0.37853087742971336 }, 
                            { 0.0, 0.8747490221364402, 7.199999999999999, 7.043592218084924, 7.199999999999999 }, 
                            { 0.0, 0.7451146968813961, 3.042391346120999, 3.0605103436991183, 3.0620893186554166 }, 
                            { 0.0, 0.0, 0.0, 0.0, 0.0 }
                          };
    ASSERT_TRUE(cip::Interp2DAssertions<NaturalSpline>(x, y, f, x_fine, y_fine, f_fine, TOLERANCE));    
}
