#include <gtest/gtest.h>
#include <cubinterpp.hpp>
#include "assertion_helpers.hpp"

using Vector = std::vector<double>;
using NaturalSpline = cip::NaturalSpline3D<double, cip::BoundaryConditionType::NotAKnot>;
constexpr double TOLERANCE = 5.0e-7;

TEST(TestCubicSpline3D, test_natural_spline_3d) {
    cip::Vector x = { 0.0, 1.0, 2.0, 3.0 };
    cip::Vector y = { 0.0, 1.0, 2.0, 3.0 };
    cip::Vector z = { 0.0, 1.0, 2.0, 3.0 };
    cip::Vector3 f = { 
                       { 
                         { 1.0, 2.0, 2.0, 2.0 }, 
                         { 2.0, 3.0, 3.0, 3.0 }, 
                         { 3.0, 3.0, 4.0, 4.0 }, 
                         { 4.0, 4.0, 4.0, 5.0 }
                     }, 
                       { 
                         { 3.0, 4.0, 4.0, 4.0 }, 
                         { 4.0, 5.0, 5.0, 5.0 }, 
                         { 5.0, 5.0, 6.0, 6.0 }, 
                         { 6.0, 6.0, 6.0, 7.0 }
                     }, 
                       { 
                         { 2.0, 3.0, 3.0, 3.0 }, 
                         { 3.0, 4.0, 4.0, 4.0 }, 
                         { 4.0, 4.0, 5.0, 5.0 }, 
                         { 5.0, 5.0, 5.0, 6.0 }
                     }, 
                       { 
                         { 4.0, 5.0, 5.0, 5.0 }, 
                         { 5.0, 6.0, 6.0, 6.0 }, 
                         { 6.0, 6.0, 7.0, 7.0 }, 
                         { 7.0, 7.0, 7.0, 8.0 }
                     }
                     };
    cip::Vector x_fine = { 0.0, 0.75, 1.5, 2.25, 3.0 };
    cip::Vector y_fine = { 0.0, 0.75, 1.5, 2.25, 3.0 };
    cip::Vector z_fine = { 0.0, 0.75, 1.5, 2.25, 3.0 };
    cip::Vector3 f_fine = { 
                            { 
                              { 1.0, 1.8828125000000002, 2.0625, 1.9609375, 2.0 }, 
                              { 1.7500000000000002, 2.82232666015625, 2.88720703125, 2.63348388671875, 2.75 }, 
                              { 2.5, 2.8422851562500004, 3.31640625, 3.63232421875, 3.5000000000000004 }, 
                              { 3.2499999999999996, 2.9215698242187504, 3.5874023437500004, 4.33453369140625, 4.25 }, 
                              { 4.0, 4.0390625, 3.9375, 4.1171875, 5.0 }
                          }, 
                            { 
                              { 3.015625, 3.8984375000000013, 4.078125, 3.976562499999999, 4.015625 }, 
                              { 3.765625, 4.837951660156251, 4.902832031250001, 4.649108886718752, 4.765625000000001 }, 
                              { 4.515625000000001, 4.857910156250001, 5.332031250000002, 5.64794921875, 5.515625 }, 
                              { 5.265625000000001, 4.93719482421875, 5.603027343750002, 6.350158691406249, 6.265625 }, 
                              { 6.015625, 6.054687500000001, 5.953125000000001, 6.1328125, 7.015625000000002 }
                          }, 
                            { 
                              { 2.5, 3.3828125000000004, 3.5625000000000004, 3.4609374999999996, 3.5000000000000004 }, 
                              { 3.25, 4.322326660156252, 4.387207031250001, 4.13348388671875, 4.250000000000001 }, 
                              { 4.000000000000002, 4.34228515625, 4.816406250000001, 5.13232421875, 5.0 }, 
                              { 4.75, 4.42156982421875, 5.087402343750001, 5.83453369140625, 5.750000000000001 }, 
                              { 5.5, 5.539062500000001, 5.437500000000001, 5.6171875, 6.500000000000002 }
                          }, 
                            { 
                              { 1.984375, 2.8671875, 3.0468750000000004, 2.9453125, 2.9843750000000004 }, 
                              { 2.734375, 3.806701660156251, 3.87158203125, 3.6178588867187496, 3.734375000000001 }, 
                              { 3.4843750000000004, 3.82666015625, 4.30078125, 4.61669921875, 4.484375 }, 
                              { 4.234375, 3.905944824218749, 4.57177734375, 5.31890869140625, 5.234375000000002 }, 
                              { 4.984375, 5.0234375, 4.921875, 5.1015625, 5.984375 }
                          }, 
                            { 
                              { 4.0, 4.8828125, 5.0625, 4.9609375, 5.0 }, 
                              { 4.75, 5.82232666015625, 5.88720703125, 5.63348388671875, 5.750000000000002 }, 
                              { 5.5, 5.84228515625, 6.31640625, 6.63232421875, 6.5 }, 
                              { 6.25, 5.92156982421875, 6.58740234375, 7.334533691406249, 7.25 }, 
                              { 7.0, 7.0390625, 6.9375, 7.1171875, 8.0 }
                          }
                          };

ASSERT_TRUE(cip::Interp3DAssertions<NaturalSpline>(x, y, z, f, x_fine, y_fine, z_fine, f_fine, TOLERANCE));    

}
