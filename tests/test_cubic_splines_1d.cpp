#include <gtest/gtest.h>
#include <cubic_splines_1d.hpp>
#include "assertion_helpers.hpp"


using Vector = std::vector<double>;
using MonotonicSpline = cip::MonotonicSpline1D<double>;
using AkimaSpline = cip::AkimaSpline1D<double>;
using NaturalSpline = cip::NaturalSpline1D<double>;


TEST(TestCubicSpline1D, test_monotonic_spline_1d) {
    cip::Vector x = { 1, 2, 3, 4.0, 5.0, 5.5, 7.0, 8.0, 9.0, 9.5, 10 };
    cip::Vector f = { 0, 0, 0, 0.5, 0.4, 1.2, 1.2, 0.1, 0.0, 0.3, 0.6 };
    cip::Vector x_fine = { 1.0, 1.375, 1.75, 2.125, 2.5, 2.875, 3.25, 3.625, 4.0, 4.375, 4.75, 5.125, 5.5, 5.875, 6.25, 6.625, 7.0, 7.375, 7.75, 8.125, 8.5, 8.875, 9.25, 9.625, 10.0 };
    cip::Vector f_fine = { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.07450161897651952, 0.3304738093015729, 0.5, 0.4542055428769416, 0.37848534450908033, 0.5453815182574999, 1.2, 1.2, 1.2, 1.2, 1.2000000000003865, 0.8762920673080998, 0.31081730769267324, 0.06762319711538467, 0.0009615384615386802, -0.01053185096153797, 0.11971153846116067, 0.3749999999999991, 0.5999999999999988 };
    ASSERT_TRUE(cip::Interp1DAssertions<MonotonicSpline>(x, f, x_fine, f_fine));
}


TEST(TestCubicSpline1D, test_akima_spline_1d) {
    cip::Vector x = { 1, 2, 3, 4.0, 5.0, 5.5, 7.0, 8.0, 9.0, 9.5, 10 };
    cip::Vector f = { 0, 0, 0, 0.5, 0.4, 1.2, 1.2, 0.1, 0.0, 0.3, 0.6 };
    cip::Vector x_fine = { 1.0, 1.375, 1.75, 2.125, 2.5, 2.875, 3.25, 3.625, 4.0, 4.375, 4.75, 5.125, 5.5, 5.875, 6.25, 6.625, 7.0, 7.375, 7.75, 8.125, 8.5, 8.875, 9.25, 9.625, 10.0 };
    cip::Vector f_fine = { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.061279296875, 0.289154052734375, 0.5, 0.4924377441406449, 0.38676757812498863, 0.532760099085408, 1.1999999999999993, 1.3822294207317043, 1.4444817073170721, 1.3844931402439027, 1.2000000000000455, 0.7961763822113426, 0.30638221153833456, 0.04557132320800861, -0.05930944055945275, -0.0412170836975676, 0.1380681818177436, 0.3749999999999991, 0.5999999999999988 };
    ASSERT_TRUE(cip::Interp1DAssertions<AkimaSpline>(x, f, x_fine, f_fine));
}


TEST(TestCubicSpline1D, test_natural_spline_1d_default) {
    cip::Vector x = { 1, 2, 3, 4.0, 5.0, 5.5, 7.0, 8.0, 9.0, 9.5, 10 };
    cip::Vector f = { 0, 0, 0, 0.5, 0.4, 1.2, 1.2, 0.1, 0.0, 0.3, 0.6 };
    cip::Vector x_fine = { 1.0, 1.375, 1.75, 2.125, 2.5, 2.875, 3.25, 3.625, 4.0, 4.375, 4.75, 5.125, 5.5, 5.875, 6.25, 6.625, 7.0, 7.375, 7.75, 8.125, 8.5, 8.875, 9.25, 9.625, 10.0 };
    cip::Vector f_fine = { 0.0, 0.019426918581435956, 0.019780135282916594, -0.017307618372552014, -0.06781760668428527, -0.04203278747619743, 0.14062197975671253, 0.3887489221178768, 0.4999999999999858, 0.36643978088321205, 0.2651799450450767, 0.5625149625701056, 1.2000000000000313, 1.6006988940364124, 1.6904619368408333, 1.5349940112248674, 1.200000000000074, 0.7602191795415933, 0.32652840047921927, 0.017931724852701336, -0.10099771450769879, -0.05005472504694808, 0.13884977145062294, 0.37825214999357115, 0.6000000000000512 };
    ASSERT_TRUE(cip::Interp1DAssertions<NaturalSpline>(x, f, x_fine, f_fine));
}


TEST(TestCubicSpline1D, test_natural_spline_1d_scipy) {
    // Note: comparison data has been generated using scipy, with CubicSpline with bc_type='natural'
    Vector x = { 1.0, 2.0, 3.0, 4.0, 5.0, 5.5, 7.0, 8.0, 9.0, 9.5, 10.0 };
    Vector f = { 0.0, 0.0, 0.0, 0.5, 0.4, 1.2, 1.2, 0.1, 0.0, 0.3, 0.6 };
    Vector x_fine = { 1.0, 1.4736842105263157, 1.9473684210526314, 2.4210526315789473, 2.894736842105263, 3.3684210526315788, 3.8421052631578947, 4.315789473684211, 4.789473684210526, 5.263157894736842, 5.7368421052631575, 6.2105263157894735, 6.684210526315789, 7.157894736842105, 7.63157894736842, 8.105263157894736, 8.578947368421051, 9.052631578947368, 9.526315789473683, 10.0 };
    Vector f_fine = { 0.0, 0.02214775316705052, 0.0058533347655776585, -0.06032626100739476, -0.036754723708176756, 0.2213803895940353, 0.48293947842213125, 0.3949614999706043, 0.2716419394796046, 0.7922596134579082, 1.4927352377302945, 1.6937014129961467, 1.4923495034986602, 1.021779073240114, 0.4555528106249871, 0.02940950346365439, -0.10348256459839837, 0.02553592123336765, 0.3167518494388597, 0.6 };
    ASSERT_TRUE(cip::Interp1DAssertions<NaturalSpline>(x, f, x_fine, f_fine));
}
